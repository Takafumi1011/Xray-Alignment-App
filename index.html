    // 改良された自動検出アルゴリズム
    function autoDetect() {
        if (!imgLoaded) return;
        const temp = document.createElement('canvas'); temp.width = 100; temp.height = 100;
        const tCtx = temp.getContext('2d'); tCtx.drawImage(img, 0, 0, 100, 100);
        const d = tCtx.getImageData(0,0,100,100).data;

        // 骨頭中心を探すための重心計算関数
        const findHipCenter = (y1, y2, x1, x2) => {
            let tx=0, ty=0, count=0, maxB=0;
            // まず領域内の最大輝度を確認
            for(let y=y1; y<y2; y++){
                for(let x=x1; x<x2; x++){
                    let i=(y*100+x)*4; let b = d[i]+d[i+1]+d[i+2];
                    if(b > maxB) maxB = b;
                }
            }
            // 最大輝度に近い（骨である可能性が高い）ピクセルのみで重心をとる
            let threshold = maxB * 0.85; 
            for(let y=y1; y<y2; y++) {
                for(let x=x1; x<x2; x++) {
                    let i=(y*100+x)*4;
                    if(d[i]+d[i+1]+d[i+2] > threshold){ tx+=x; ty+=y; count++; }
                }
            }
            return count > 0 ? { x: (tx/count)/100 * img.width, y: (ty/count)/100 * img.height } : null;
        };

        // 右股関節 (RH: points[2]) - 画面中央よりやや左寄りの上部をスキャン
        const rH = findHipCenter(10, 25, 25, 45); 
        if(rH){ points[2].x = rH.x; points[2].y = rH.y; }

        // 左股関節 (LH: points[10]) - 画面中央よりやや右寄りの上部をスキャン
        const lH = findHipCenter(10, 25, 55, 75); 
        if(lH){ points[10].x = lH.x; points[10].y = lH.y; }

        // 膝・足部も同様に閾値を最適化して再配置
        const findJoint = (y1, y2, x1, x2) => {
            let tx=0, ty=0, count=0;
            for(let y=y1; y<y2; y++) {
                for(let x=x1; x<x2; x++) {
                    let i=(y*100+x)*4; if(d[i]+d[i+1]+d[i+2] > 450){ tx+=x; ty+=y; count++; }
                }
            }
            return count > 0 ? { x: (tx/count)/100 * img.width, y: (ty/count)/100 * img.height } : null;
        };

        const rK = findJoint(40, 55, 25, 45); if(rK){ points[3].x=rK.x; points[3].y=rK.y; points[4].x=rK.x; points[4].y=rK.y+50; }
        const rA = findJoint(75, 95, 25, 45); if(rA){ points[5].x=rA.x; points[5].y=rA.y; }
        const lK = findJoint(40, 55, 55, 75); if(lK){ points[11].x=lK.x; points[11].y=lK.y; points[12].x=lK.x; points[12].y=lK.y+50; }
        const lA = findJoint(75, 95, 55, 75); if(lA){ points[13].x=lA.x; points[13].y=lA.y; }

        draw();
    }
